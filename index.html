<!DOCTYPE html>

<html><head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<script src="lib/three.min.js"></script>
	<script src="lib/orbitcontrols.js"></script>
	<!-- fallback if no WebGL -->
	<script src="lib/projector.js"></script>
	<script src="lib/canvasrenderer.js"></script>
	<script src="lib/jquery-2.1.3.min.js"></script>
	<script src="src/csg.js"></script>
	<script src="src/threecsg.js"></script>
	<script src="src/openjscad.js"></script>
	<script src="src/formats.js"></script>

	<style>

	body {
		font: 14px/20px 'Helvetica Neue Light', HelveticaNeue-Light, 'Helvetica Neue', Helvetica, Arial, sans-serif;
		max-width: 820px;
		margin: 0 auto;
		padding: 10px;
	}

	pre, code, textarea {
		font: 12px/20px Monaco, monospace;
		border: 1px solid #CCC;
		border-radius: 3px;
		background: #F9F9F9;
		padding: 0 3px;
		color: #555;
	}
	pre, textarea {
		padding: 10px;
		width: 100%;
	}
	textarea {
		height: 200px;
	}
	textarea:focus {
		outline: none;
	}

	canvas { cursor: move; }

	</style>
	
<link rel="stylesheet" href="openjscad.css" type="text/css">

<script>
var gProcessor=null;
var params = {faces:[], length:0, width:0, height:0, density:0};

// Show all exceptions to the user:
OpenJsCad.AlertUserOfUncaughtExceptions();

function onload() {
	gProcessor = new OpenJsCad.Processor(document.getElementById("viewer"));
	updateSolid();
	updateSize();
}

function toggleTile(face, x, y) {
	if (params.faces[face][y][x] === 0) {
		params.faces[face][y][x] = 1;
	}
	else {
		params.faces[face][y][x] = 0;
	}
	displayFaces();
}

function updateSize() {
	length = document.getElementById("length").value;
	width = document.getElementById("width").value;
	height = document.getElementById("height").value;
	density = document.getElementById("density").value;
	//TODO: ACCOUNT FOR DENSITY!
	
	var tempFaces = []
	
	//DRY this jazz!
	tempFaces[0]=[];
	for(var i=0; i < height; i++) {
		tempFaces[0][i]=[];
		for(var j=0; j < length; j++) {
			tempFaces[0][i][j] = 1;
		}
	}
	
	tempFaces[1]=[];
	for(var i=0; i < height; i++) {
		tempFaces[1][i]=[];
		for(var j=0; j < width; j++) {
			tempFaces[1][i][j] = 1;
		}
	}
	
	tempFaces[2]=[];
	for(var i=0; i < width; i++) {
		tempFaces[2][i]=[];
		for(var j=0; j < length; j++) {
			tempFaces[2][i][j] = 1;
		}
	}
	
	params.length = length;
	params.width = width;
	params.height = height;
	params.density = density;
	params.faces = tempFaces;
	displayFaces();
}

function displayFaces() {
	//add VAR in for loops for jscad code 
	x = document.getElementById("x");
	y = document.getElementById("y");
	z = document.getElementById("z");
	
	length = params.faces[0][0].length;
	width = params.faces[1][0].length;
	height = params.faces[0].length;
	//double check values?
	//DRY on 3 faces!
	
	xhtml = "";
	for(var i=0; i < height; i++) {
		xhtml += "<tr>";
		for(var j=0; j < length; j++) {
			var color = "blue"
			if (params.faces[0][i][j] === 0) {
				color = "white";
			}
			xhtml += "<td style=\"background-color:" + color + "\" onclick=\"javascript:toggleTile(" + 0 + ", " + j + ", " + i + ")\"></td>";
		}
		xhtml += "<tr>";
	}
	
	yhtml = "";
	for(var i=0; i < height; i++) {
		yhtml += "<tr>";
		for(var j=0; j < width; j++) {
			var color = "blue"
			if (params.faces[1][i][j] === 0) {
				color = "white";
			}
			yhtml += "<td style=\"background-color:" + color + "\" onclick=\"javascript:toggleTile(" + 1 + ", " +  j + ", " + i + ")\"></td>";
		}
		yhtml += "</tr>";
	}
	
	zhtml = "";
	for(var i=0; i < width; i++) {
		zhtml += "<tr>";
		for(var j=0; j < length; j++) {
			var color = "blue"
			if (params.faces[2][i][j] === 0) {
				color = "white";
			}
			zhtml += "<td style=\"background-color:" +  color + "\" onclick=\"javascript:toggleTile(" + 2 + ", " + j + ", " + i + ")\"></td>";
		}
		zhtml += "</tr>";
	}
	
	x.innerHTML = xhtml;
	y.innerHTML = yhtml;
	z.innerHTML = zhtml;
	
	updateCode();
}

function updateCode() {
	//UPDATE PARAMETERS INPUT: how?!?
	updateSolid();
}

function updateSolid()
{
	gProcessor.setJsCad(document.getElementById('code').value);
}
</script>

<title>OpenJsCad</title>  
</head>
<body onload="onload()">
<h1>Customizable monagram cubes!</h1>
what a world to live in
<br><br>
<div id="viewer"></div>
<br><br>
length:
<input id="length" type="number" value="10" onchange="updateSize()">
width:
<input id="width" type="number" value="10" onchange="updateSize()">
height:
<input id="height" type="number" value="10" onchange="updateSize()">
density:
<input id="density" type="number" value="1" onchange="updateSize()">
force >0 somehow
<br><br>
x:
<table id="x" class="face"></table>
<br>
y:
<table id="y" class="face"></table>
<br>
z:
<table id="z" class="face"></table>
<input type="submit" value="Update" onclick="updateSolid(); return false;">
<br><br>
Edit the very code that defines the model:
<textarea id="code">
//todo: n faces
//smoothing?

function main(params) {
	var paramsObj = JSON.parse(params.paramstring);
	var faces = paramsObj.faces;
	var voxelsize = paramsObj.density;

	length = faces[0][0].length;
	width = faces[1][0].length;
	height = faces[0].length;
	
	var box = CSG.cube({corner1:[0,0,0], corner2:[length, width, height]});
	
	for(face = 0; face < faces.length; face++) {
		for(y = 0; y < faces[face].length; y++) {
			for(x = 0; x < faces[face][y].length; x++) {
				if(faces[face][y][x] === 0) {
					//translate as a function of corners?
					if(face === 0){
						var cutbox = CSG.cube({corner1:[0,0,0], corner2:[length, 1, 1]});
						cutbox = cutbox.translate([0,x,(height-y-1)]);
					}
					else if(face === 1) {
						var cutbox = CSG.cube({corner1:[0,0,0], corner2:[1, width, 1]});
						cutbox = cutbox.translate([x,0,(height-y-1)]);
					}
					else if(face === 2) {
						var cutbox = CSG.cube({corner1:[0,0,0], corner2:[1, 1, height]});
						cutbox = cutbox.translate([x,(width-y-1),0]);
					}
					box = box.subtract(cutbox);
				}
			}
		}
	}
	
	box = box.scale([voxelsize,voxelsize,voxelsize]);
	box = box.center();
	
	return(box);
	
}

function getParameterDefinitions() {
  return [
    {
      name: 'paramstring', 
      type: 'text', 
      initial: '{"faces":[[[1,1],[1,1]],[[1,1],[1,1]],[[1,1],[1,1]]],"length":"2","width":"2","height":"2","density":"1"}',
      caption: "JSON String:"
    }
  ];
}
</textarea>
<br>
<input type="submit" value="Update" onclick="updateSolid(); return false;">
<br><br>
Copyright as footer, metion SPENTRONICS, and the VAST LEGION OF OPEN SOURCE CONTRIBUTERS that I  have SHAMLESSLY RIPPED OFF
</body>
</html>