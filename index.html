<!DOCTYPE html>

<html><head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<script src="lib/three.min.js"></script>
	<script src="lib/orbitcontrols.js"></script>
	<!-- fallback if no WebGL -->
	<script src="lib/projector.js"></script>
	<script src="lib/canvasrenderer.js"></script>
	<script src="lib/jquery-2.1.3.min.js"></script>
	<script src="src/csg.js"></script>
	<script src="src/threecsg.js"></script>
	<script src="src/openjscad.js"></script>
	<script src="src/formats.js"></script>

	<style>

	body {
		font: 14px/20px 'Helvetica Neue Light', HelveticaNeue-Light, 'Helvetica Neue', Helvetica, Arial, sans-serif;
		max-width: 820px;
		margin: 0 auto;
		padding: 10px;
	}

	pre, code, textarea {
		font: 12px/20px Monaco, monospace;
		border: 1px solid #CCC;
		border-radius: 3px;
		background: #F9F9F9;
		padding: 0 3px;
		color: #555;
	}
	pre, textarea {
		padding: 10px;
		width: 100%;
	}
	textarea {
		height: 200px;
	}
	textarea:focus {
		outline: none;
	}

	canvas { cursor: move; }

	</style>
	
<link rel="stylesheet" href="openjscad.css" type="text/css">

<script>
var gProcessor=null;

// Show all exceptions to the user:
OpenJsCad.AlertUserOfUncaughtExceptions();

function onload()
{
	gProcessor = new OpenJsCad.Processor(document.getElementById("viewer"));
	updateSolid();
}

function updateSolid()
{
	//update code div with new faces array
	gProcessor.setJsCad(document.getElementById('code').value);
}
</script>

<title>OpenJsCad</title>  
</head>
<body onload="onload()">
TODO: Header here
<div id="viewer"></div>
<br><br>
<textarea id="code">
!OpenSCAD
faces = [
    [
        [1,1],
        [1,0],
        [1,0]
    ],[
        [0,1],
        [1,1],
        [1,0]
    ],[
        [0,1],
        [1,1]
    ]
];

voxelsize = 4;

length = len(faces[0][0]);
width = len(faces[1][0]);
height = len(faces[0]);

scale([voxelsize,voxelsize,voxelsize]) {
    difference() {
        cube(size=[length, width, height]);
        for(face=[0:len(faces)-1]) {
            for(y=[0:len(faces[face])-1]) {
                for(x=[0:len(faces[face][y])]) {
                    if(faces[face][y][x]==0) {
                        //generalize to N-faces
                        if(face==0){
                            translate([0,x,(height-y-1)])cube([length,1,1]);
                        }
                        else if(face==1) {
                            translate([x,0,(height-y-1)])cube([1,width,1]);
                        }
                        else if(face==2) {
                            translate([x,(width-y-1),0])cube([1,1,height]);
                        }
                        else {
                            echo("3 faces only for now ): ");
                        }
                    }
                }
            }
        }
    }
}
</textarea>
<br>
<input type="submit" value="Update" onclick="updateSolid(); return false;">
</body>
</html>